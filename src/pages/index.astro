---
import BaseLayout from '../layouts/BaseLayout.astro';
import HeroImage from '../components/HeroImage.astro';
import EntryListItem from '../components/EntryListItem.astro';
import { getPublished } from '../lib/content';
import { getListExcerpt } from '../utils/excerpt';

const posts = await getPublished('posts', {
  orderBy: (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
});
const essays = await getPublished('essay', {
  orderBy: (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
});

const merged = [
  ...posts.map((entry) => ({ type: 'posts', entry })),
  ...essays.map((entry) => ({ type: 'essay', entry }))
].sort((a, b) => b.entry.data.date.valueOf() - a.entry.data.date.valueOf());

const latest = merged.slice(0, 12);
---

<BaseLayout bodyClass="home">
  <div class="hero">
    <HeroImage isLCP />
  </div>

  <div class="intro intro--serif">
    <span class="intro__lead">这是一个开源的写作主题与样例内容库：随笔/essay、归档/archive、碎片化记录/bits。使用与配置见文档（README / Docs）。</span>
    <span class="intro__more">更多文章请访问 <a href="/archive/">归档</a> 或 <a href="/essay/">随笔</a>。</span>
  </div>

  <h2 class="section-title section-title--index">索引</h2>

  <div class="list">
    {latest.map(({ type, entry }) => {
      const slug = entry.data.slug ?? entry.id;
      const href = type === 'posts' ? `/archive/${slug}/` : `/essay/${slug}/`;
      const tag = entry.data.tags?.[0];
      return (
        <EntryListItem
          href={href}
          title={entry.data.title}
          date={entry.data.date}
          tag={tag}
          excerpt={getListExcerpt(entry)}
        />
      );
    })}
  </div>
</BaseLayout>
