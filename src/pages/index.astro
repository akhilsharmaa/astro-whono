---
import BaseLayout from '../layouts/BaseLayout.astro';
import HeroImage from '../components/HeroImage.astro';
import EntryListItem from '../components/EntryListItem.astro';
import { getPublished, isReservedSlug } from '../lib/content';
import { getListExcerpt } from '../utils/excerpt';
import { createWithBase } from '../utils/format';

const base = import.meta.env.BASE_URL ?? '/';
const withBase = createWithBase(base);

const essays = await getPublished('essay', {
  orderBy: (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
});

const visibleEssays = essays.filter((entry) => !isReservedSlug(entry.data.slug ?? entry.id));
const latest = visibleEssays.slice(0, 12);
---

<BaseLayout bodyClass="home">
  <h1 className="sr-only">Akhilesh</h1>
  <div className="hero">
    <HeroImage isLCP />
  </div>

  <div className="intro intro--serif">
    <span className="intro__lead">
      Welcome to my personal website. This is a collection of my writings, notes, archives, and short thoughts where I share ideas, experiences, and learnings.
    </span>
    <span className="intro__more">
      Browse more posts in the <a href={withBase('/archive/')}>Archive</a> or explore my <a href={withBase('/essay/')}>Essays</a>.
    </span>
  </div>

  <h2 className="section-title section-title--index">Index</h2>

  <div className="list">
    {latest.map((entry) => {
      const slug = entry.data.slug ?? entry.id;
      const href = withBase(`/archive/${slug}/`);
      const tag = entry.data.tags?.[0];
      return (
        <EntryListItem
          href={href}
          title={entry.data.title}
          date={entry.data.date}
          tag={tag}
          excerpt={getListExcerpt(entry)}
        />
      );
    })}
  </div>
</BaseLayout>
