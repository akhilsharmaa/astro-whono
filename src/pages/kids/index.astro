---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getEntry, render } from 'astro:content';

const prod = import.meta.env.PROD;

const entry = await getEntry('kids', 'index');
if (!entry) {
  throw new Error('Missing kids page entry: src/content/kids/index.md');
}
if (prod && entry.data.draft) {
  throw new Error('Kids entry is marked draft...');
}

const { Content, headings } = await render(entry);

// Build a grouped TOC: H2 as section titles, H3 as items.
const groups = [];
let current = null;
for (const h of headings) {
  if (h.depth === 2) {
    current = { title: h.text, items: [] };
    groups.push(current);
  } else if (h.depth === 3) {
    if (!current) {
      current = { title: '目录', items: [] };
      groups.push(current);
    }
    current.items.push({ text: h.text, slug: h.slug });
  }
}
---

<BaseLayout title="孩童">
  <div style="display:flex; align-items:baseline; gap:12px;">
    <h1 class="page-title" style="margin:0;">{entry.data.title}</h1>
    {entry.data.subtitle ? <span class="kids-subtitle">{entry.data.subtitle}</span> : null}
  </div>

  <div class="intro">
    我在一些笔记软件中记录着一个 “#孩子” 这样的标签，主要是仿照感恩日记，对生活可能被遗忘的美好做一些记录。
    其中大部分内容回看的时候都能想起一些有趣的瞬间。
  </div>

  <nav class="kids-toc" aria-label="目录">
    {groups.map((g) => (
      <details open>
        <summary>{g.title}</summary>
        <ul class="toc-items">
          {g.items.map((it, i) => (
            <li>
              <a href={`#${it.slug}`}>
                <span class="toc-num">{i + 1}</span>
                <span>{it.text}</span>
              </a>
            </li>
          ))}
        </ul>
      </details>
    ))}
  </nav>

  <div class="kids-content prose">
    <Content />
  </div>
</BaseLayout>
